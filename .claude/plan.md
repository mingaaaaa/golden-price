# é»„é‡‘ä»·æ ¼ç›‘æ§ä¸æ¨é€ç³»ç»Ÿ - å®æ–½è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šé»„é‡‘ä»·æ ¼ç›‘æ§ä¸æ¨é€ç³»ç»Ÿ
**æŠ€æœ¯æ ˆ**ï¼šNext.js 14 + TypeScript + Prisma + SQLite + node-schedule + Ant Design + Recharts
**éƒ¨ç½²æ–¹å¼**ï¼šPM2 å®ˆæŠ¤è¿›ç¨‹
**å¼€å‘æ¨¡å¼**ï¼šå®šæ—¶ä»»åŠ¡ä»…åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 1. æ•°æ®é‡‡é›†
- **å“ç§**ï¼šAUTDï¼ˆé»„é‡‘å»¶æœŸï¼‰
- **é‡‡é›†é¢‘ç‡**ï¼šæ¯5åˆ†é’Ÿï¼ˆä¼˜åŒ–åï¼‰
- **æ•°æ®æº**ï¼š
  - ä¸»æ¥å£ï¼š`https://www.huilvbiao.com/api/gold_indexApi`ï¼ˆå®æ—¶æ•°æ®ï¼‰
  - å¤‡ç”¨æ¥å£ï¼š`https://www.huilvbiao.com/api/gold_autd_real`ï¼ˆå†å²æ•°æ®ï¼Œç”¨äºåˆå§‹åŒ–ï¼‰
- **å­˜å‚¨**ï¼šSQLite æ•°æ®åº“ï¼ˆä¿ç•™35å¤©æ•°æ®ï¼Œå®šæœŸæ¸…ç†ï¼‰
- **æ•°æ®é‡é¢„ä¼°**ï¼š5åˆ†é’Ÿç²’åº¦ Ã— 288æ¡/å¤© Ã— 35å¤© â‰ˆ 10,080æ¡

### 2. æ•°æ®å¯è§†åŒ–
- **é¡µé¢è·¯å¾„**ï¼š`/dashboard`
- **å›¾è¡¨åŠŸèƒ½**ï¼š
  - æ—¶è§†å›¾ï¼ˆè¿‘24å°æ—¶ï¼Œæ¯5åˆ†é’Ÿ1ä¸ªç‚¹ = 288ä¸ªç‚¹ï¼‰
  - å¤©è§†å›¾ï¼ˆè¿‘35å¤©ï¼Œæ¯1å°æ—¶1ä¸ªç‚¹ = 840ä¸ªç‚¹ï¼‰
- **ç»Ÿè®¡å¡ç‰‡**ï¼šä»Šæ—¥æœ€é«˜ä»·ã€æœ€ä½ä»·ã€å¹³å‡ä»·ã€æ¶¨è·Œå¹…
- **ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šå“åº”å¼è®¾è®¡

### 3. æ¨é€ç­–ç•¥
- **å®šæ—¶æ¨é€**ï¼š8:00-24:00 æ¯å°æ—¶æ•´ç‚¹æ¨é€å½“å‰ä»·æ ¼ + æ¶¨è·Œå¹…
- **é¢„è­¦æ¨é€**ï¼šä»·æ ¼è¶…è¿‡/ä½äºç›®æ ‡ä»·æ—¶æ¨é€ï¼ˆé˜ˆå€¼å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
- **æ—¥æŠ¥æ¨é€**ï¼š24:00 æ¨é€å½“æ—¥æ±‡æ€»ï¼ˆå¼€ç›˜ã€æ”¶ç›˜ã€æœ€é«˜ã€æœ€ä½ã€æ¶¨è·Œå¹…ï¼‰
- **å¼‚å¸¸å‘Šè­¦**ï¼šæ¥å£è¿ç»­å¤±è´¥3æ¬¡æ¨é€é€šçŸ¥

### 4. æ•°æ®è´¨é‡ä¿éšœ
- **æ•°æ®éªŒè¯**ï¼šä»·æ ¼èŒƒå›´æ ¡éªŒï¼ˆ500-2000å…ƒ/å…‹ï¼‰ï¼Œæ¶¨è·Œå¹…>10%æ ‡è®°å¼‚å¸¸
- **æ¥å£å®¹é”™**ï¼šaxios 3æ¬¡é‡è¯•ï¼Œè¶…æ—¶æ—¶é—´5ç§’
- **ä»»åŠ¡é”**ï¼šé˜²æ­¢å®šæ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ
- **é”™è¯¯æ—¥å¿—**ï¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ `logs/error.log`
- **å®šæœŸæ¸…ç†**ï¼šæ¯å¤©å‡Œæ™¨2:00æ¸…ç†è¶…è¿‡35å¤©çš„æ•°æ®

---

## ğŸ“ é¡¹ç›®ç»“æ„è®¾è®¡

```
golden_price/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                    # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                      # é¦–é¡µï¼ˆé‡å®šå‘åˆ°/dashboardï¼‰
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ page.tsx                  # Dashboardä¸»é¡µé¢
â”‚   â”‚   â””â”€â”€ components/               # Dashboardç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ GoldChart.tsx         # å›¾è¡¨ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ StatCards.tsx         # ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ AlertSettings.tsx     # é¢„è­¦è®¾ç½®ç»„ä»¶ï¼ˆæ•°æ®åº“å…±äº«ï¼‰
â”‚   â”‚       â””â”€â”€ SystemMonitor.tsx     # ç³»ç»Ÿç›‘æ§ç»„ä»¶
â”‚   â””â”€â”€ api/                          # API Routes
â”‚       â”œâ”€â”€ gold/realtime/route.ts    # GET è·å–å®æ—¶é‡‘ä»·
â”‚       â”œâ”€â”€ gold/history/route.ts     # GET è·å–å†å²æ•°æ®
â”‚       â”œâ”€â”€ alert/config/route.ts     # GET/PUT é¢„è­¦é…ç½®
â”‚       â”œâ”€â”€ alert/check/route.ts      # POST æ£€æŸ¥é¢„è­¦ï¼ˆå®šæ—¶ä»»åŠ¡ç”¨ï¼‰
â”‚       â””â”€â”€ webhook/test/route.ts     # POST æµ‹è¯•é’‰é’‰æ¨é€
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                         # Prismaå®¢æˆ·ç«¯å®ä¾‹
â”‚   â”œâ”€â”€ gold-service.ts               # é»„é‡‘ä»·æ ¼æœåŠ¡ï¼ˆé‡‡é›†ã€è§£æã€å­˜å‚¨ï¼‰
â”‚   â”œâ”€â”€ dingtalk.ts                   # é’‰é’‰æ¨é€æœåŠ¡
â”‚   â”œâ”€â”€ scheduler.ts                  # å®šæ—¶ä»»åŠ¡ç®¡ç†
â”‚   â””â”€â”€ logger.ts                     # æ—¥å¿—å·¥å…·
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma                 # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ migrations/                   # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ constants.ts                  # å…¨å±€å¸¸é‡é…ç½®
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                      # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ public/
â”‚   â””â”€â”€ ecosystem.config.cjs          # PM2é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ next.config.js                    # Next.jsé…ç½®
â”œâ”€â”€ tsconfig.json                     # TypeScripté…ç½®
â”œâ”€â”€ package.json                      # ä¾èµ–ç®¡ç†
â”œâ”€â”€ README.md                         # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ logs/                             # æ—¥å¿—ç›®å½•ï¼ˆ.gitignoreï¼‰
    â””â”€â”€ error.log                     # é”™è¯¯æ—¥å¿—
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### Prisma Schema

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// é»„é‡‘ä»·æ ¼æ•°æ®è¡¨
model GoldPrice {
  id             Int      @id @default(autoincrement())
  price          Float     // å½“å‰ä»·æ ¼
  openPrice      Float     // å¼€ç›˜ä»·
  highPrice      Float     // æœ€é«˜ä»·
  lowPrice       Float     // æœ€ä½ä»·
  buyPrice       Float     // ä¹°å…¥ä»·
  sellPrice      Float     // å–å‡ºä»·
  changePercent  Float     // æ¶¨è·Œå¹…ï¼ˆ%ï¼‰
  changeAmount   Float     // æ¶¨è·Œé¢
  volume         Int?      // æˆäº¤é‡ï¼ˆå¯é€‰ï¼‰
  collectedAt    DateTime  @unique // é‡‡é›†æ—¶é—´ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œé˜²é‡ï¼‰
  createdAt      DateTime  @default(now())

  @@index([collectedAt])
  @@index([createdAt])
}

// é’‰é’‰æ¨é€è®°å½•è¡¨
model PushLog {
  id        Int      @id @default(autoincrement())
  type      String   // æ¨é€ç±»å‹: "hourly", "alert", "daily", "error"
  content   String   // æ¨é€å†…å®¹
  success   Boolean  // æ˜¯å¦æˆåŠŸ
  error     String?  // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([type])
}

// é¢„è­¦é…ç½®è¡¨ï¼ˆå…¨å±€å…±äº«ï¼Œæ‰€æœ‰ç”¨æˆ·å…±ç”¨ä¸€ä¸ªé…ç½®ï¼‰
model AlertConfig {
  id          Int      @id @default(autoincrement())
  highPrice   Float?   // é«˜ä½é¢„è­¦ä»·æ ¼ï¼ˆnullè¡¨ç¤ºä¸å¯ç”¨ï¼‰
  lowPrice    Float?   // ä½ä½é¢„è­¦ä»·æ ¼ï¼ˆnullè¡¨ç¤ºä¸å¯ç”¨ï¼‰
  enabled     Boolean  @default(true) // é¢„è­¦å¼€å…³
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
}

// ç³»ç»Ÿé…ç½®è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºå­˜å‚¨åŠ¨æ€é…ç½®ï¼‰
model SystemConfig {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}
```

### æ•°æ®åº“åˆå§‹åŒ–

**åˆå§‹åŒ–å‘½ä»¤**ï¼š
```bash
pnpm prisma generate
pnpm prisma migrate dev --name init
```

**åˆå§‹åŒ–é¢„è­¦é…ç½®**ï¼ˆåˆ›å»ºé»˜è®¤è®°å½•ï¼‰ï¼š
```sql
-- æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­æ’å…¥ï¼Œæˆ–ä½¿ç”¨ Prisma Client
INSERT INTO AlertConfig (highPrice, lowPrice, enabled)
VALUES (1250.0, 1200.0, true);
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. é»„é‡‘ä»·æ ¼æœåŠ¡ (`lib/gold-service.ts`)

**èŒè´£**ï¼š
- è°ƒç”¨æ¥å£è·å–å®æ—¶æ•°æ®
- è§£æ `huilvbiao.com/api/gold_indexApi` è¿”å›çš„æ•°æ®æ ¼å¼
- æ•°æ®éªŒè¯å’Œæ¸…æ´—
- å­˜å‚¨åˆ°æ•°æ®åº“ï¼ˆå¸¦å»é‡ï¼‰
- è¯·æ±‚å¤±è´¥é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- æ¸…ç†è¶…è¿‡35å¤©çš„æ—§æ•°æ®

**æ ¸å¿ƒå‡½æ•°**ï¼š
```typescript
// è·å–å®æ—¶é‡‘ä»·
async function fetchRealtimePrice(): Promise<GoldPriceData | null>

// è§£ææ¥å£è¿”å›æ•°æ®ï¼ˆè§£æ hq_str_gds_AUTD æ ¼å¼ï¼‰
function parsePriceData(rawData: string): GoldPriceData | null

// éªŒè¯æ•°æ®æœ‰æ•ˆæ€§ï¼ˆ500-2000å…ƒ/å…‹ï¼Œæ¶¨è·Œå¹…<10%ï¼‰
function validatePriceData(data: GoldPriceData): boolean

// ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆå¸¦å»é‡ï¼ŒåŸºäº collectedAt å”¯ä¸€ç´¢å¼•ï¼‰
async function savePriceData(data: GoldPriceData): Promise<boolean>

// è·å–å†å²æ•°æ®ï¼ˆæ”¯æŒæ—¶é—´èŒƒå›´å’Œç²’åº¦ï¼‰
async function getHistoryData(
  startTime: Date,
  endTime: Date,
  interval: 'raw' | 'hour'
): Promise<GoldPriceData[]>

// æ¸…ç†æ—§æ•°æ®ï¼ˆè¶…è¿‡35å¤©ï¼‰
async function cleanupOldData(days: number = 35): Promise<number>
```

### 2. é’‰é’‰æ¨é€æœåŠ¡ (`lib/dingtalk.ts`)

**èŒè´£**ï¼š
- æ„å»ºæ¨é€æ¶ˆæ¯æ ¼å¼
- å‘é€HTTPè¯·æ±‚åˆ°é’‰é’‰Webhook
- è®°å½•æ¨é€æ—¥å¿—åˆ°æ•°æ®åº“

**æ¨é€æ¶ˆæ¯æ ¼å¼**ï¼š
```typescript
// å°æ—¶æ¨é€
ã€é»„é‡‘ä»·æ ¼å°æ—¶æŠ¥ã€‘10:00
å½“å‰AUTDä»·æ ¼ï¼š1248.40 å…ƒ/å…‹
ä»Šæ—¥æ¶¨è·Œå¹…ï¼š+0.52%ï¼ˆ+6.48å…ƒï¼‰
ä»Šæ—¥æœ€é«˜ï¼š1255.00 å…ƒ/å…‹
ä»Šæ—¥æœ€ä½ï¼š1242.00 å…ƒ/å…‹

// é¢„è­¦æ¨é€ï¼ˆä»æ•°æ®åº“è¯»å–AlertConfigï¼‰
ã€é»„é‡‘ä»·æ ¼é¢„è­¦ã€‘âš ï¸
AUTDä»·æ ¼çªç ´ç›®æ ‡ä»·ï¼
å½“å‰ä»·æ ¼ï¼š1250.50 å…ƒ/å…‹
ç›®æ ‡ä»·æ ¼ï¼š1250.00 å…ƒ/å…‹
æ—¶é—´ï¼š2026-01-29 10:15:00

// æ—¥æŠ¥æ¨é€
ã€é»„é‡‘ä»·æ ¼æ—¥æŠ¥ - 2026-01-29ã€‘
AUTDï¼ˆé»„é‡‘å»¶æœŸï¼‰ï¼š
å¼€ç›˜ï¼š1234.0 å…ƒ/å…‹
æ”¶ç›˜ï¼š1245.4 å…ƒ/å…‹
æœ€é«˜ï¼š1255.0 å…ƒ/å…‹
æœ€ä½ï¼š1242.0 å…ƒ/å…‹
æ¶¨è·Œå¹…ï¼š+7.08%

// å¼‚å¸¸å‘Šè­¦
ã€ç³»ç»Ÿå¼‚å¸¸å‘Šè­¦ã€‘âŒ
æ•°æ®é‡‡é›†è¿ç»­å¤±è´¥3æ¬¡
æœ€åä¸€æ¬¡é”™è¯¯ï¼šæ¥å£è¯·æ±‚è¶…æ—¶
æ—¶é—´ï¼š2026-01-29 10:15:00
```

**æ ¸å¿ƒå‡½æ•°**ï¼š
```typescript
// å‘é€å°æ—¶æŠ¥
async function sendHourlyReport(priceData: GoldPriceData): Promise<boolean>

// å‘é€é¢„è­¦ï¼ˆä»æ•°æ®åº“è¯»å–AlertConfigï¼‰
async function sendAlert(
  currentPrice: number,
  alertConfig: AlertConfig
): Promise<boolean>

// å‘é€æ—¥æŠ¥
async function sendDailyReport(date: Date): Promise<boolean>

// å‘é€å¼‚å¸¸å‘Šè­¦
async function sendErrorAlert(errorMessage: string): Promise<boolean>

// è®°å½•æ¨é€æ—¥å¿—åˆ°æ•°æ®åº“
async function logPush(
  type: string,
  content: string,
  success: boolean,
  error?: string
): Promise<void>
```

### 3. å®šæ—¶ä»»åŠ¡è°ƒåº¦ (`lib/scheduler.ts`)

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰å®šæ—¶ä»»åŠ¡
- é˜²æ­¢ä»»åŠ¡é‡å¤æ‰§è¡Œï¼ˆä»»åŠ¡é”ï¼‰
- è®°å½•ä»»åŠ¡æ‰§è¡Œæ—¥å¿—

**å®šæ—¶ä»»åŠ¡åˆ—è¡¨**ï¼š
```typescript
// ä»»åŠ¡1ï¼šæ¯5åˆ†é’Ÿé‡‡é›†é‡‘ä»·ï¼ˆä»…ç”Ÿäº§ç¯å¢ƒï¼‰
scheduleJob('*/5 * * * *', collectGoldPrice)

// ä»»åŠ¡2ï¼šæ¯å°æ—¶æ¨é€ï¼ˆ8:00-23:00ï¼‰
scheduleJob('0 8-23 * * *', sendHourlyReport)

// ä»»åŠ¡3ï¼šæ¯æ—¥æ—¥æŠ¥ï¼ˆ24:00ï¼‰
scheduleJob('0 0 * * *', sendDailyReport)

// ä»»åŠ¡4ï¼šæ¯5åˆ†é’Ÿæ£€æŸ¥é¢„è­¦ï¼ˆä»æ•°æ®åº“è¯»å–AlertConfigï¼‰
scheduleJob('*/5 * * * *', checkPriceAlert)

// ä»»åŠ¡5ï¼šæ¯å¤©å‡Œæ™¨2:00æ¸…ç†æ—§æ•°æ®
scheduleJob('0 2 * * *', cleanupOldData)
```

**æ ¸å¿ƒå‡½æ•°**ï¼š
```typescript
// åˆå§‹åŒ–æ‰€æœ‰å®šæ—¶ä»»åŠ¡
function initScheduler(): void

// é‡‡é›†é‡‘ä»·ä»»åŠ¡
async function collectGoldPrice(): Promise<void>

// å‘é€å°æ—¶æŠ¥ä»»åŠ¡
async function sendHourlyReportTask(): Promise<void>

// æ£€æŸ¥é¢„è­¦ä»»åŠ¡ï¼ˆä»æ•°æ®åº“è¯»å–AlertConfigï¼Œåˆ¤æ–­æ˜¯å¦æ¨é€ï¼‰
async function checkPriceAlertTask(): Promise<void>

// æ¸…ç†æ—§æ•°æ®ä»»åŠ¡
async function cleanupOldDataTask(): Promise<void>

// è·å–ä»»åŠ¡é”ï¼ˆé˜²æ­¢é‡å¤æ‰§è¡Œï¼‰
function acquireTaskLock(taskName: string): boolean

// é‡Šæ”¾ä»»åŠ¡é”
function releaseTaskLock(taskName: string): void
```

### 4. API Routes è®¾è®¡

#### `GET /api/gold/realtime`
è·å–å½“å‰å®æ—¶é‡‘ä»·

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "price": 1248.40,
    "openPrice": 1245.2,
    "highPrice": 1255.0,
    "lowPrice": 1242.0,
    "changePercent": 0.52,
    "changeAmount": 6.48,
    "collectedAt": "2026-01-29T10:15:00Z"
  }
}
```

#### `GET /api/gold/history?view=hour|day`
è·å–å†å²æ•°æ®

**å‚æ•°**ï¼š
- `view`: `hour`ï¼ˆ24å°æ—¶ï¼‰æˆ– `day`ï¼ˆ35å¤©ï¼‰

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "price": 1248.40,
      "collectedAt": "2026-01-29T10:00:00Z"
    },
    ...
  ]
}
```

#### `GET /api/alert/config`
è·å–é¢„è­¦é…ç½®ï¼ˆæ•°æ®åº“å…±äº«ï¼‰

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "highPrice": 1250.00,
    "lowPrice": 1200.00,
    "enabled": true
  }
}
```

#### `PUT /api/alert/config`
æ›´æ–°é¢„è­¦é…ç½®ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰

**è¯·æ±‚ä½“**ï¼š
```json
{
  "highPrice": 1250.00,
  "lowPrice": 1200.00,
  "enabled": true
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "é¢„è­¦é…ç½®å·²æ›´æ–°"
}
```

#### `POST /api/alert/check`
æ£€æŸ¥é¢„è­¦ï¼ˆå®šæ—¶ä»»åŠ¡è°ƒç”¨ï¼Œæˆ–æ‰‹åŠ¨æµ‹è¯•ï¼‰

**å“åº”**ï¼š
```json
{
  "success": true,
  "shouldAlert": true,
  "alertType": "high",
  "message": "å½“å‰ä»·æ ¼ 1250.50 å·²è¶…è¿‡ç›®æ ‡ä»· 1250.00"
}
```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶è®¾è®¡

### 1. Dashboard ä¸»é¡µé¢ (`app/dashboard/page.tsx`)

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼èˆªæ ï¼šé»„é‡‘ä»·æ ¼ç›‘æ§                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»Ÿè®¡å¡ç‰‡ï¼ˆ4ä¸ªï¼‰                     â”‚
â”‚  [ä»Šæ—¥æœ€é«˜] [ä»Šæ—¥æœ€ä½] [ä»Šæ—¥å¹³å‡] [æ¶¨è·Œå¹…] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è§†å›¾åˆ‡æ¢ï¼š[æ—¶è§†å›¾] [å¤©è§†å›¾]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å›¾è¡¨åŒºåŸŸ                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Recharts æŠ˜çº¿å›¾           â”‚   â”‚
â”‚  â”‚   Xè½´ï¼šæ—¶é—´                 â”‚   â”‚
â”‚  â”‚   Yè½´ï¼šä»·æ ¼ï¼ˆå…ƒ/å…‹ï¼‰         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢„è­¦è®¾ç½®ï¼ˆæ•°æ®åº“å…±äº«ï¼Œå…¨å±€é…ç½®ï¼‰   â”‚
â”‚  [ ] é«˜äº _1250_ å…ƒæ—¶æé†’           â”‚
â”‚  [ ] ä½äº _1200_ å…ƒæ—¶æé†’           â”‚
â”‚  [ ] å¯ç”¨é¢„è­¦                      â”‚
â”‚  [ä¿å­˜è®¾ç½®]                         â”‚
â”‚  æç¤ºï¼šæ‰€æœ‰ç”¨æˆ·å…±äº«æ­¤é…ç½®           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç³»ç»Ÿç›‘æ§ï¼ˆå¯é€‰ï¼‰                    â”‚
â”‚  æœ€åæ›´æ–°ï¼š10:15:00                 â”‚
â”‚  æ¥å£çŠ¶æ€ï¼šâœ… æ­£å¸¸                   â”‚
â”‚  ä»Šæ—¥é‡‡é›†ï¼š288æ¡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å›¾è¡¨ç»„ä»¶ (`components/GoldChart.tsx`)

**åŠŸèƒ½**ï¼š
- ä½¿ç”¨ Recharts ç»˜åˆ¶æŠ˜çº¿å›¾
- æ”¯æŒ Tooltipï¼ˆé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…ï¼‰
- Xè½´ï¼šæ—¶é—´
- Yè½´ï¼šä»·æ ¼ï¼ˆå…ƒ/å…‹ï¼‰
- æ ‡æ³¨ï¼šæœ€é«˜ä»·ã€æœ€ä½ä»·ç‚¹
- æ•°æ®ç‚¹ï¼šæ—¶è§†å›¾288ä¸ªç‚¹ï¼Œå¤©è§†å›¾840ä¸ªç‚¹

### 3. ç»Ÿè®¡å¡ç‰‡ç»„ä»¶ (`components/StatCards.tsx`)

**å¡ç‰‡å†…å®¹**ï¼š
- ä»Šæ—¥æœ€é«˜ä»·ï¼ˆçº¢è‰²ï¼‰
- ä»Šæ—¥æœ€ä½ä»·ï¼ˆç»¿è‰²ï¼‰
- ä»Šæ—¥å¹³å‡ä»·ï¼ˆè“è‰²ï¼‰
- ä»Šæ—¥æ¶¨è·Œå¹…ï¼ˆ+ ç»¿è‰²ï¼Œ- çº¢è‰²ï¼‰

### 4. é¢„è­¦è®¾ç½®ç»„ä»¶ (`components/AlertSettings.tsx`)

**åŠŸèƒ½**ï¼š
- ä»æ•°æ®åº“è¯»å–å½“å‰é…ç½®ï¼ˆ`GET /api/alert/config`ï¼‰
- è¡¨å•è¾“å…¥ï¼šé«˜ä½é¢„è­¦ä»·æ ¼
- è¡¨å•è¾“å…¥ï¼šä½ä½é¢„è­¦ä»·æ ¼
- å¼€å…³ï¼šå¯ç”¨/ç¦ç”¨é¢„è­¦
- ä¿å­˜æŒ‰é’®ï¼šæ›´æ–°åˆ°æ•°æ®åº“ï¼ˆ`PUT /api/alert/config`ï¼‰
- **é‡è¦æç¤º**ï¼š"æ‰€æœ‰ç”¨æˆ·å…±äº«æ­¤é…ç½®"

### 5. ç§»åŠ¨ç«¯é€‚é…

**å“åº”å¼æ–­ç‚¹**ï¼š
- æ¡Œé¢ç«¯ï¼ˆ>768pxï¼‰ï¼šç»Ÿè®¡å¡ç‰‡æ¨ªå‘æ’åˆ—
- ç§»åŠ¨ç«¯ï¼ˆ<768pxï¼‰ï¼šç»Ÿè®¡å¡ç‰‡çºµå‘å †å 
- å›¾è¡¨ï¼šè‡ªåŠ¨ç¼©æ”¾ï¼Œæ”¯æŒæ‰‹åŠ¿æ‹–åŠ¨

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### `.env.example`

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="file:./prisma/dev.db"

# é’‰é’‰æœºå™¨äººé…ç½®
DINGTALK_WEBHOOK="https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN"
DINGTALK_SECRET=""  # é’‰é’‰æœºå™¨äººå¯†é’¥ï¼ˆå¦‚æœå¯ç”¨äº†åŠ ç­¾ï¼Œå¯é€‰ï¼‰

# æœåŠ¡ç«¯å£
PORT=3000

# Nodeç¯å¢ƒï¼ˆdevelopment | productionï¼‰
NODE_ENV="production"

# æ¥å£é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•ï¼‰
GOLD_API_URL="https://www.huilvbiao.com/api/gold_indexApi"
GOLD_HISTORY_API_URL="https://www.huilvbiao.com/api/gold_autd_real"

# æ•°æ®é‡‡é›†é…ç½®
COLLECTION_INTERVAL_MINUTES=5  # é‡‡é›†é—´éš”ï¼š5åˆ†é’Ÿ
ENABLE_SCHEDULER=true  # ç”Ÿäº§ç¯å¢ƒè®¾ä¸ºtrueï¼Œå¼€å‘ç¯å¢ƒè®¾ä¸ºfalse
DATA_RETENTION_DAYS=35  # æ•°æ®ä¿ç•™å¤©æ•°
```

---

## ğŸ“¦ ä¾èµ–ç®¡ç†

### `package.json`

```json
{
  "name": "golden-price",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "prisma generate && next build",
    "start": "next start",
    "lint": "next lint",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio",
    "pm2:start": "pm2 start ecosystem.config.cjs",
    "pm2:stop": "pm2 stop golden-price",
    "pm2:restart": "pm2 restart golden-price",
    "pm2:logs": "pm2 logs golden-price"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "antd": "^5.22.0",
    "recharts": "^2.15.0",
    "@prisma/client": "^5.22.0",
    "axios": "^1.7.0",
    "node-schedule": "^2.1.1",
    "dayjs": "^1.11.0"
  },
  "devDependencies": {
    "typescript": "^5.7.0",
    "@types/node": "^22.0.0",
    "@types/react": "^18.3.0",
    "@types/react-dom": "^18.3.0",
    "@types/node-schedule": "^2.1.0",
    "prisma": "^5.22.0",
    "pm2": "^5.4.0"
  },
  "packageManager": "pnpm@9.0.0"
}
```

---

## ğŸš€ éƒ¨ç½²é…ç½®

### PM2 é…ç½®æ–‡ä»¶ (`public/ecosystem.config.cjs`)

```javascript
module.exports = {
  apps: [
    {
      name: 'golden-price',
      script: 'node_modules/.bin/next',
      args: 'start',
      cwd: './',
      instances: 1,
      exec_mode: 'fork',
      autorestart: true,
      watch: false,
      max_memory_restart: '1G',
      env: {
        NODE_ENV: 'production',
        PORT: 3000,
        ENABLE_SCHEDULER: true
      },
      error_file: './logs/pm2-error.log',
      out_file: './logs/pm2-out.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      merge_logs: true
    }
  ]
};
```

### éƒ¨ç½²å‘½ä»¤

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. åˆå§‹åŒ–æ•°æ®åº“
pnpm prisma generate
pnpm prisma migrate dev --name init

# 3. åˆå§‹åŒ–é¢„è­¦é…ç½®ï¼ˆé€šè¿‡APIæˆ–æ•°æ®åº“ç›´æ¥åˆ›å»ºï¼‰
# æ–¹å¼1ï¼šä½¿ç”¨ Prisma Studio
pnpm prisma studio
# ç„¶ååœ¨ AlertConfig è¡¨ä¸­æ‰‹åŠ¨æ’å…¥è®°å½•

# æ–¹å¼2ï¼šé€šè¿‡APIåˆå§‹åŒ–ï¼ˆéƒ¨ç½²åè®¿é—®é¡µé¢åˆ›å»ºï¼‰

# 4. æ„å»ºé¡¹ç›®
pnpm build

# 5. å¯åŠ¨æœåŠ¡ï¼ˆPM2ï¼‰
pnpm pm2:start

# 6. æŸ¥çœ‹æ—¥å¿—
pnpm pm2:logs

# 7. æŸ¥çœ‹çŠ¶æ€
pm2 status
```

---

## ğŸ“ å®æ–½æ­¥éª¤

### é˜¶æ®µä¸€ï¼šé¡¹ç›®åˆå§‹åŒ–ï¼ˆ1å°æ—¶ï¼‰

1. **åˆ›å»ºNext.jsé¡¹ç›®**
   ```bash
   pnpm create next-app@latest golden-price --typescript --tailwind --app
   cd golden_price
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   pnpm add antd recharts axios node-schedule dayjs
   pnpm add -D prisma @types/node-schedule pm2
   ```

3. **é…ç½®Prisma**
   - åˆ›å»º `prisma/schema.prisma`ï¼ˆåŒ…å« AlertConfig è¡¨ï¼‰
   - é…ç½® `DATABASE_URL="file:./prisma/dev.db"`
   - è¿è¡Œ `pnpm prisma migrate dev --name init`

4. **åˆå§‹åŒ–é¢„è­¦é…ç½®**
   - åœ¨æ•°æ®åº“ä¸­åˆ›å»ºé»˜è®¤çš„ AlertConfig è®°å½•
   - è®¾ç½®ï¼šhighPrice=1250, lowPrice=1200, enabled=true

5. **é…ç½®ç¯å¢ƒå˜é‡**
   - å¤åˆ¶ `.env.example` ä¸º `.env`
   - é…ç½®é’‰é’‰Webhook
   - è®¾ç½®é‡‡é›†é—´éš”ä¸º5åˆ†é’Ÿ

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒæœåŠ¡å¼€å‘ï¼ˆ3-4å°æ—¶ï¼‰

6. **å®ç°é»„é‡‘ä»·æ ¼æœåŠ¡** (`lib/gold-service.ts`)
   - æ¥å£è¯·æ±‚å‡½æ•°ï¼ˆè°ƒç”¨ huilvbiao.com APIï¼‰
   - æ•°æ®è§£æå‡½æ•°ï¼ˆè§£æ `var hq_str_gds_AUTD = ...` æ ¼å¼ï¼‰
   - æ•°æ®éªŒè¯å‡½æ•°ï¼ˆ500-2000å…ƒ/å…‹ï¼Œæ¶¨è·Œå¹…<10%ï¼‰
   - æ•°æ®å­˜å‚¨å‡½æ•°ï¼ˆå¸¦å»é‡ï¼‰
   - æ¸…ç†æ—§æ•°æ®å‡½æ•°ï¼ˆ35å¤©ï¼‰

7. **å®ç°é’‰é’‰æ¨é€æœåŠ¡** (`lib/dingtalk.ts`)
   - æ„å»ºæ¶ˆæ¯æ ¼å¼ï¼ˆ4ç§ç±»å‹ï¼‰
   - HTTPè¯·æ±‚å‡½æ•°
   - æ¨é€æ—¥å¿—è®°å½•ï¼ˆå†™å…¥ PushLog è¡¨ï¼‰

8. **å®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦** (`lib/scheduler.ts`)
   - ä»»åŠ¡é”æœºåˆ¶
   - 5ä¸ªå®šæ—¶ä»»åŠ¡
   - ä»æ•°æ®åº“è¯»å– AlertConfig è¿›è¡Œé¢„è­¦åˆ¤æ–­
   - é”™è¯¯å¤„ç†å’Œæ—¥å¿—

9. **å®ç°API Routes**
   - `GET /api/gold/realtime` - å®æ—¶é‡‘ä»·
   - `GET /api/gold/history` - å†å²æ•°æ®
   - `GET /api/alert/config` - è·å–é¢„è­¦é…ç½®
   - `PUT /api/alert/config` - æ›´æ–°é¢„è­¦é…ç½®
   - `POST /api/alert/check` - æ£€æŸ¥é¢„è­¦

### é˜¶æ®µä¸‰ï¼šå‰ç«¯å¼€å‘ï¼ˆ2-3å°æ—¶ï¼‰

10. **åˆ›å»ºDashboardä¸»é¡µé¢**
    - å¸ƒå±€å’Œå¯¼èˆª
    - å“åº”å¼è®¾è®¡

11. **å®ç°ç»Ÿè®¡å¡ç‰‡ç»„ä»¶**
    - è·å–ä»Šæ—¥ç»Ÿè®¡æ•°æ®
    - å±•ç¤º4ä¸ªæŒ‡æ ‡

12. **å®ç°å›¾è¡¨ç»„ä»¶**
    - RechartsæŠ˜çº¿å›¾
    - è§†å›¾åˆ‡æ¢ï¼ˆæ—¶/å¤©ï¼‰
    - Tooltipå’Œæ ‡æ³¨

13. **å®ç°é¢„è­¦è®¾ç½®ç»„ä»¶**
    - ä»æ•°æ®åº“è¯»å–é…ç½®
    - è¡¨å•è¾“å…¥ï¼ˆé«˜ä½ã€ä½ä½ã€å¯ç”¨å¼€å…³ï¼‰
    - ä¿å­˜åˆ°æ•°æ®åº“
    - **æç¤º"å…¨å±€å…±äº«é…ç½®"**

14. **ç§»åŠ¨ç«¯ä¼˜åŒ–**
    - å“åº”å¼å¸ƒå±€
    - è§¦æ‘¸äº¤äº’ä¼˜åŒ–

### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ2å°æ—¶ï¼‰

15. **åŠŸèƒ½æµ‹è¯•**
    - æ¯5åˆ†é’Ÿæ•°æ®é‡‡é›†æµ‹è¯•
    - æ¨é€åŠŸèƒ½æµ‹è¯•ï¼ˆ4ç§ç±»å‹ï¼‰
    - å›¾è¡¨å±•ç¤ºæµ‹è¯•
    - é¢„è­¦åŠŸèƒ½æµ‹è¯•ï¼ˆæ•°æ®åº“é…ç½®ï¼‰
    - æ•°æ®æ¸…ç†æµ‹è¯•

16. **å¼‚å¸¸å¤„ç†æµ‹è¯•**
    - æ¥å£å¤±è´¥é‡è¯•
    - æ•°æ®éªŒè¯è¿‡æ»¤
    - ä»»åŠ¡é”é˜²é‡

17. **æ€§èƒ½ä¼˜åŒ–**
    - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæ·»åŠ ç´¢å¼•ï¼‰
    - å‰ç«¯åŠ è½½ä¼˜åŒ–
    - å†…å­˜æ³„æ¼æ£€æŸ¥

### é˜¶æ®µäº”ï¼šéƒ¨ç½²ä¸æ–‡æ¡£ï¼ˆ1å°æ—¶ï¼‰

18. **ç¼–å†™éƒ¨ç½²æ–‡æ¡£**
    - README.md
    - éƒ¨ç½²æ­¥éª¤
    - å¸¸è§é—®é¢˜

19. **é…ç½®PM2**
    - ecosystem.config.cjs
    - æµ‹è¯•å¯åŠ¨å’Œé‡å¯

20. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
    - æœåŠ¡å™¨é…ç½®
    - ç¯å¢ƒå˜é‡é…ç½®
    - å¯åŠ¨æœåŠ¡

21. **ç›‘æ§å’ŒéªŒè¯**
    - æŸ¥çœ‹PM2æ—¥å¿—
    - éªŒè¯å®šæ—¶ä»»åŠ¡
    - éªŒè¯é’‰é’‰æ¨é€
    - éªŒè¯æ•°æ®æ¸…ç†

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

**æ•°æ®é‡‡é›†**ï¼š
- [ ] æ¯5åˆ†é’ŸæˆåŠŸé‡‡é›†AUTDä»·æ ¼å¹¶å­˜å‚¨åˆ°æ•°æ®åº“
- [ ] æ•°æ®è§£ææ­£ç¡®ï¼ˆè§£æ huilvbiao.com API æ ¼å¼ï¼‰
- [ ] æ•°æ®å»é‡æ­£å¸¸ï¼ˆåŸºäº collectedAt å”¯ä¸€ç´¢å¼•ï¼‰
- [ ] å¼‚å¸¸æ•°æ®è¢«è¿‡æ»¤ï¼ˆä»·æ ¼èŒƒå›´ã€æ¶¨è·Œå¹…ï¼‰
- [ ] æ¥å£å¤±è´¥é‡è¯•3æ¬¡

**æ•°æ®æ¸…ç†**ï¼š
- [ ] æ¯å¤©å‡Œæ™¨2:00æ¸…ç†è¶…è¿‡35å¤©çš„æ•°æ®
- [ ] æ¸…ç†åæ•°æ®åº“å¤§å°åˆç†ï¼ˆçº¦10,080æ¡ï¼‰

**æ¨é€åŠŸèƒ½**ï¼š
- [ ] æ¯å°æ—¶æ•´ç‚¹æˆåŠŸæ¨é€é’‰é’‰æ¶ˆæ¯ï¼ˆ8:00-23:00ï¼‰
- [ ] 24:00æˆåŠŸæ¨é€æ—¥æŠ¥
- [ ] ä»·æ ¼è¶…è¿‡é«˜ä½é¢„è­¦æ—¶æ¨é€ï¼ˆä»æ•°æ®åº“è¯»å–é…ç½®ï¼‰
- [ ] ä»·æ ¼ä½äºä½ä½é¢„è­¦æ—¶æ¨é€ï¼ˆä»æ•°æ®åº“è¯»å–é…ç½®ï¼‰
- [ ] æ¥å£è¿ç»­å¤±è´¥3æ¬¡æ¨é€å¼‚å¸¸å‘Šè­¦
- [ ] æ¨é€æ—¥å¿—æ­£ç¡®è®°å½•åˆ°æ•°æ®åº“

**å›¾è¡¨å±•ç¤º**ï¼š
- [ ] Dashboardé¡µé¢æ­£å¸¸æ˜¾ç¤ºå®æ—¶ä»·æ ¼
- [ ] æ—¶è§†å›¾æ˜¾ç¤ºè¿‘24å°æ—¶æ•°æ®ï¼ˆ288ä¸ªç‚¹ï¼‰
- [ ] å¤©è§†å›¾æ˜¾ç¤ºè¿‘35å¤©æ•°æ®ï¼ˆ840ä¸ªç‚¹ï¼‰
- [ ] ç»Ÿè®¡å¡ç‰‡æ•°æ®æ­£ç¡®
- [ ] å›¾è¡¨æ¸²æŸ“æµç•…ï¼Œæ— å¡é¡¿

**é¢„è­¦é…ç½®**ï¼š
- [ ] å¯ä»¥è¯»å–æ•°æ®åº“ä¸­çš„é¢„è­¦é…ç½®
- [ ] å¯ä»¥æ›´æ–°é¢„è­¦é…ç½®
- [ ] é¢„è­¦å¼€å…³æ­£å¸¸ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- [ ] æç¤º"å…¨å±€å…±äº«é…ç½®"

**ç§»åŠ¨ç«¯**ï¼š
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸
- [ ] è§¦æ‘¸äº¤äº’æµç•…

**å®šæ—¶ä»»åŠ¡**ï¼š
- [ ] ä»»åŠ¡é”é˜²æ­¢é‡å¤æ‰§è¡Œ
- [ ] PM2é‡å¯åå®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ¢å¤

### APIæµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•å®æ—¶é‡‘ä»·æ¥å£
curl http://localhost:3000/api/gold/realtime

# æµ‹è¯•å†å²æ•°æ®æ¥å£ï¼ˆæ—¶è§†å›¾ï¼‰
curl http://localhost:3000/api/gold/history?view=hour

# æµ‹è¯•å†å²æ•°æ®æ¥å£ï¼ˆå¤©è§†å›¾ï¼‰
curl http://localhost:3000/api/gold/history?view=day

# æµ‹è¯•è·å–é¢„è­¦é…ç½®
curl http://localhost:3000/api/alert/config

# æµ‹è¯•æ›´æ–°é¢„è­¦é…ç½®
curl -X PUT http://localhost:3000/api/alert/config \
  -H "Content-Type: application/json" \
  -d '{"highPrice":1250,"lowPrice":1200,"enabled":true}'

# æµ‹è¯•æ£€æŸ¥é¢„è­¦
curl -X POST http://localhost:3000/api/alert/check
```

---

## ğŸ“š æ–‡æ¡£æ¸…å•

- [ ] README.md - é¡¹ç›®ä»‹ç»å’Œå¿«é€Ÿå¼€å§‹
- [ ] DEPLOYMENT.md - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- [ ] API.md - APIæ¥å£æ–‡æ¡£
- [ ] .env.example - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- [ ] é’‰é’‰æœºå™¨äººé…ç½®æ•™ç¨‹

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **é‡‡é›†é¢‘ç‡**ï¼šæ¯5åˆ†é’Ÿ1æ¬¡ï¼ˆæ•°æ®é‡ï¼š288æ¡/å¤©ï¼Œ10,080æ¡/35å¤©ï¼‰
2. **æ•°æ®ä¿ç•™**ï¼š35å¤©è‡ªåŠ¨æ¸…ç†ï¼Œæ•°æ®åº“å¤§å°ç¨³å®šåœ¨10,000æ¡å·¦å³
3. **é¢„è­¦é…ç½®**ï¼šå­˜å‚¨åœ¨ AlertConfig è¡¨ï¼Œæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œå…¨å±€å”¯ä¸€
4. **å¼€å‘æ¨¡å¼**ï¼šå®šæ—¶ä»»åŠ¡ä¸å¯ç”¨ï¼ˆ`ENABLE_SCHEDULER=false`ï¼‰ï¼Œæ‰‹åŠ¨æµ‹è¯•æ¥å£
5. **ç”Ÿäº§æ¨¡å¼**ï¼šå®šæ—¶ä»»åŠ¡è‡ªåŠ¨å¯åŠ¨ï¼ˆ`ENABLE_SCHEDULER=true`ï¼‰ï¼ŒPM2å®ˆæŠ¤
6. **æ•°æ®å»é‡**ï¼šæ•°æ®åº“ `collectedAt` å­—æ®µæœ‰å”¯ä¸€ç´¢å¼•
7. **ä»»åŠ¡é”**ï¼šé˜²æ­¢å®šæ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ
8. **é”™è¯¯æ—¥å¿—**ï¼šå®šæœŸæ¸…ç† `logs/error.log`ï¼Œé¿å…æ–‡ä»¶è¿‡å¤§
9. **æ•°æ®åº“å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ `prisma/dev.db`
10. **é’‰é’‰é™æµ**ï¼šæ¯åˆ†é’Ÿæœ€å¤š20æ¡ï¼Œå½“å‰æ¨é€é¢‘ç‡ä¸ä¼šè¶…é™

---

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

âœ… æ¯5åˆ†é’ŸæˆåŠŸé‡‡é›†AUTDä»·æ ¼å¹¶å­˜å‚¨åˆ°æ•°æ®åº“
âœ… Dashboardé¡µé¢æ­£å¸¸æ˜¾ç¤ºå®æ—¶ä»·æ ¼å’Œå†å²å›¾è¡¨
âœ… æ—¶è§†å›¾æ˜¾ç¤ºè¿‘24å°æ—¶æ•°æ®ï¼ˆ288ä¸ªç‚¹ï¼‰
âœ… å¤©è§†å›¾æ˜¾ç¤ºè¿‘35å¤©æ•°æ®ï¼ˆ840ä¸ªç‚¹ï¼‰
âœ… ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºæ­£ç¡®çš„ä»Šæ—¥æœ€é«˜ã€æœ€ä½ã€å¹³å‡ã€æ¶¨è·Œå¹…
âœ… æ¯å°æ—¶æ•´ç‚¹æˆåŠŸæ¨é€é’‰é’‰æ¶ˆæ¯ï¼ˆ8:00-23:00ï¼‰
âœ… 24:00æˆåŠŸæ¨é€æ—¥æŠ¥
âœ… ä»·æ ¼è¶…è¿‡é«˜ä½é¢„è­¦æ—¶æ¨é€ï¼ˆä»æ•°æ®åº“è¯»å–é…ç½®ï¼‰
âœ… ä»·æ ¼ä½äºä½ä½é¢„è­¦æ—¶æ¨é€ï¼ˆä»æ•°æ®åº“è¯»å–é…ç½®ï¼‰
âœ… æ¥å£è¿ç»­å¤±è´¥3æ¬¡æ¨é€å¼‚å¸¸å‘Šè­¦
âœ… æ¯å¤©å‡Œæ™¨2:00æ¸…ç†è¶…è¿‡35å¤©çš„æ•°æ®
âœ… ç§»åŠ¨ç«¯æ­£å¸¸æ˜¾ç¤ºå’Œæ“ä½œ
âœ… é¢„è­¦é…ç½®å¯åœ¨çº¿ä¿®æ”¹ï¼ˆå…¨å±€å…±äº«ï¼‰

### æ€§èƒ½éªŒæ”¶

âœ… é¡µé¢é¦–æ¬¡åŠ è½½æ—¶é—´ < 3ç§’
âœ… å›¾è¡¨æ¸²æŸ“æµç•…ï¼ˆ288-840ä¸ªæ•°æ®ç‚¹ï¼‰
âœ… æ¥å£å“åº”æ—¶é—´ < 1ç§’
âœ… å®šæ—¶ä»»åŠ¡ä¸é‡å æ‰§è¡Œ
âœ… å†…å­˜å ç”¨ < 500MB
âœ… æ•°æ®åº“æŸ¥è¯¢ < 100msï¼ˆ10,080æ¡æ•°æ®ï¼‰

### ç¨³å®šæ€§éªŒæ”¶

âœ… æœåŠ¡è¿ç»­è¿è¡Œ7å¤©æ— å´©æºƒ
âœ… æ¥å£å¤±è´¥è‡ªåŠ¨é‡è¯•3æ¬¡
âœ… å¼‚å¸¸æ•°æ®è¢«è¿‡æ»¤ï¼Œä¸æ±¡æŸ“æ•°æ®åº“
âœ… PM2è‡ªåŠ¨é‡å¯æœåŠ¡ï¼Œå®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ¢å¤
âœ… é”™è¯¯æ—¥å¿—å®Œæ•´è®°å½•
âœ… æ•°æ®å®šæœŸè‡ªåŠ¨æ¸…ç†ï¼Œæ•°æ®åº“å¤§å°ç¨³å®š

---

## ğŸ¯ é¡¹ç›®äº¤ä»˜ç‰©

- [ ] å®Œæ•´çš„é¡¹ç›®æºä»£ç ï¼ˆæ— é‚®ä»¶ç›¸å…³ä»£ç ï¼‰
- [ ] Prismaæ•°æ®åº“æ¨¡å‹å’Œè¿ç§»æ–‡ä»¶ï¼ˆåŒ…å« AlertConfig è¡¨ï¼‰
- [ ] `.env.example` ç¯å¢ƒå˜é‡ç¤ºä¾‹
- [ ] `ecosystem.config.cjs` PM2é…ç½®æ–‡ä»¶
- [ ] `README.md` é¡¹ç›®æ–‡æ¡£ï¼ˆåŒ…å«å¿«é€Ÿå¼€å§‹ï¼‰
- [ ] `DEPLOYMENT.md` éƒ¨ç½²æ–‡æ¡£
- [ ] é’‰é’‰æœºå™¨äººé…ç½®æ•™ç¨‹
- [ ] æ•°æ®åº“åˆå§‹åŒ–å‘½ä»¤
- [ ] é¢„è­¦é…ç½®åˆå§‹åŒ–è¯´æ˜

---

## ğŸ“… æ—¶é—´ä¼°ç®—

- é˜¶æ®µä¸€ï¼ˆé¡¹ç›®åˆå§‹åŒ–ï¼‰ï¼š1å°æ—¶
- é˜¶æ®µäºŒï¼ˆæ ¸å¿ƒæœåŠ¡ï¼‰ï¼š3-4å°æ—¶
- é˜¶æ®µä¸‰ï¼ˆå‰ç«¯å¼€å‘ï¼‰ï¼š2-3å°æ—¶
- é˜¶æ®µå››ï¼ˆæµ‹è¯•ä¼˜åŒ–ï¼‰ï¼š2å°æ—¶
- é˜¶æ®µäº”ï¼ˆéƒ¨ç½²æ–‡æ¡£ï¼‰ï¼š1å°æ—¶

**æ€»è®¡**ï¼š9-11å°æ—¶ï¼ˆ1.5-2ä¸ªå·¥ä½œæ—¥ï¼‰

---

## ğŸ”— å…³é”®æ–‡ä»¶æ¸…å•

**æ ¸å¿ƒæœåŠ¡æ–‡ä»¶**ï¼š
- `lib/gold-service.ts` - é»„é‡‘ä»·æ ¼æœåŠ¡ï¼ˆ600è¡Œï¼Œå«æ¸…ç†å‡½æ•°ï¼‰
- `lib/dingtalk.ts` - é’‰é’‰æ¨é€æœåŠ¡ï¼ˆ350è¡Œï¼Œå«æ—¥å¿—è®°å½•ï¼‰
- `lib/scheduler.ts` - å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆ450è¡Œï¼Œå«5ä¸ªä»»åŠ¡ï¼‰
- `lib/db.ts` - Prismaå®¢æˆ·ç«¯ï¼ˆ50è¡Œï¼‰
- `lib/logger.ts` - æ—¥å¿—å·¥å…·ï¼ˆ100è¡Œï¼‰

**å‰ç«¯ç»„ä»¶**ï¼š
- `app/dashboard/page.tsx` - Dashboardä¸»é¡µé¢ï¼ˆ200è¡Œï¼‰
- `app/dashboard/components/GoldChart.tsx` - å›¾è¡¨ç»„ä»¶ï¼ˆ150è¡Œï¼‰
- `app/dashboard/components/StatCards.tsx` - ç»Ÿè®¡å¡ç‰‡ï¼ˆ100è¡Œï¼‰
- `app/dashboard/components/AlertSettings.tsx` - é¢„è­¦è®¾ç½®ï¼ˆ200è¡Œï¼Œæ•°æ®åº“æ“ä½œï¼‰

**API Routes**ï¼š
- `app/api/gold/realtime/route.ts` - å®æ—¶é‡‘ä»·APIï¼ˆ50è¡Œï¼‰
- `app/api/gold/history/route.ts` - å†å²æ•°æ®APIï¼ˆ120è¡Œï¼Œå«èšåˆï¼‰
- `app/api/alert/config/route.ts` - é¢„è­¦é…ç½®APIï¼ˆ100è¡Œï¼‰
- `app/api/alert/check/route.ts` - é¢„è­¦æ£€æŸ¥APIï¼ˆ80è¡Œï¼‰

**é…ç½®æ–‡ä»¶**ï¼š
- `prisma/schema.prisma` - æ•°æ®åº“æ¨¡å‹ï¼ˆ70è¡Œï¼Œå« AlertConfigï¼‰
- `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼ˆ35è¡Œï¼‰
- `next.config.js` - Next.jsé…ç½®ï¼ˆ20è¡Œï¼‰
- `ecosystem.config.cjs` - PM2é…ç½®ï¼ˆ30è¡Œï¼‰

**é¢„è®¡æ€»ä»£ç é‡**ï¼šçº¦2700-3200è¡Œ

---

## ğŸ“ åç»­æ”¯æŒ

é¡¹ç›®äº¤ä»˜åï¼Œå¦‚éœ€è°ƒæ•´æˆ–æ‰©å±•åŠŸèƒ½ï¼š
- è°ƒæ•´é‡‡é›†é¢‘ç‡ï¼ˆå½“å‰5åˆ†é’Ÿï¼‰
- è°ƒæ•´æ•°æ®ä¿ç•™å¤©æ•°ï¼ˆå½“å‰35å¤©ï¼‰
- æ·»åŠ æ–°çš„æ•°æ®æŒ‡æ ‡
- ä¼˜åŒ–å›¾è¡¨å±•ç¤º
- æ·»åŠ å…¶ä»–è´µé‡‘å±å“ç§ï¼ˆç™½é“¶ã€é“‚é‡‘ç­‰ï¼‰
- æ·»åŠ å¤šç”¨æˆ·ç³»ç»Ÿï¼ˆä¸ªæ€§åŒ–é¢„è­¦ï¼‰
- æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½

---

**è®¡åˆ’åˆ¶å®šæ—¶é—´**ï¼š2026-01-29
**æœ€åæ›´æ–°æ—¶é—´**ï¼š2026-01-29
**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š1.5-2ä¸ªå·¥ä½œæ—¥

**æŠ€æœ¯æ ˆç‰ˆæœ¬**ï¼š
- Next.js: 14.2.0
- React: 18.3.0
- TypeScript: 5.7.0
- Prisma: 5.22.0
- Node.js: >=18.17.0

**å…³é”®æ”¹è¿›ç‚¹**ï¼š
âœ… é‡‡é›†é¢‘ç‡ä¼˜åŒ–ï¼šæ¯åˆ†é’Ÿ â†’ æ¯5åˆ†é’Ÿï¼ˆæ•°æ®é‡å‡å°‘80%ï¼‰
âœ… æ•°æ®ä¿ç•™æœŸï¼š35å¤©ï¼Œè‡ªåŠ¨æ¸…ç†
âœ… é¢„è­¦å­˜å‚¨ï¼šlocalStorage â†’ æ•°æ®åº“ï¼ˆAlertConfigè¡¨ï¼‰
âœ… å…¨å±€é…ç½®ï¼šæ‰€æœ‰ç”¨æˆ·å…±äº«ä¸€ä¸ªé¢„è­¦é˜ˆå€¼
âœ… æœåŠ¡ç«¯æ¨é€ï¼šå®šæ—¶ä»»åŠ¡ä»æ•°æ®åº“è¯»å–é…ç½®å¹¶æ¨é€é’‰é’‰
